# Close any open System Preferences panes, to prevent them from overriding
# settings we’re about to change
osascript -e 'tell application "System Preferences" to quit'

# Ask for the administrator password upfront
sudo -v

# Keep-alive: update existing `sudo` time stamp until `.macos` has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

# Install xcode command line tools
xcode-select --install 2> /dev/null

# Install brew if absent
if [[ ! $(which brew) ]]; then 
	/usr/bin/env bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)" 
fi

# Make sure we're up to date
brew update; brew upgrade

to_install=(
	git
	ripgrep
	fd
	node
	python3	
	wget
	tmux
	tldr
)

brew install ${to_install[@]}

# Prepare
brew cask 2> /dev/null
brew tap homebrew/cask-fonts


# Stock cellar
to_install=(
	spotify
	google-chrome
	onedrive
	mactex
	intellij-idea
	clion
	visual-studio
	visual-studio-code
	spectacle
	alacritty
	font-fira-code
	iterm2
)

brew cask install ${to_install[@]}

# Clean up cellar
brew cleanup


# Set computer name (as done via System Preferences → Sharing)
#sudo scutil --set ComputerName "0x6D746873"
#sudo scutil --set HostName "0x6D746873"
#sudo scutil --set LocalHostName "0x6D746873"
#sudo defaults write /Library/Preferences/SystemConfiguration/com.apple.smb.server NetBIOSName -string "0x6D746873"

# Disable the sound effects on boot
sudo nvram SystemAudioVolume=" "

# Disable 'resume where you left' app feature
defaults write NSGlobalDomain NSQuitAlwaysKeepsWindows -bool false

# Disable automatic termination of inactive apps
defaults write NSGlobalDomain NSDisableAutomaticTermination -bool true

# Make finder quittable
defaults write com.apple.finder QuitMenuItem -bool true; killall Finder

# Disable open/close window animations
defaults write NSGlobalDomain NSAutomaticWindowAnimationsEnabled -bool false

# Accelerate window resize for cocoa apps
defaults write NSGlobalDomain NSWindowResizeTime -float 0.001

# Disable window animation when opening from dock
defaults write com.apple.dock launchanim -bool false

# Speed up mission control animations
defaults write com.apple.dock expose-animation-duration -float 0.1

# Automatically hide and show the Dock
defaults write com.apple.dock autohide -bool true

# Disable dock animation delay
defaults write com.apple.Dock autohide-delay -float 0

# Don’t show recent applications in Dock
defaults write com.apple.dock show-recents -bool false

# Hide desktop icons completely
defaults write com.apple.finder CreateDesktop -bool false

# Enable mousepad tap click
defaults write com.apple.AppleMultitouchTrackpad Clicking -bool true

# Enable subpixel font rendering on non-Apple LCDs
defaults write NSGlobalDomain AppleFontSmoothing -int 2

# Disable press-and-hold for keys in favor of key repeat
defaults write NSGlobalDomain ApplePressAndHoldEnabled -bool false

# Never go into computer sleep mode
sudo systemsetup -setcomputersleep Off > /dev/null

# Wipe all (default) app icons from the Dock
# This is only really useful when setting up a new Mac, or if you don’t use
# the Dock to launch apps.
defaults write com.apple.dock persistent-apps -array

# Show only open applications in the Dock
defaults write com.apple.dock static-only -bool true
